<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
	<style type="text/css">
		body {
			background: #333;
			text-align: center;
			margin-top: 10%;
		}
		#videoCanvas {
			width: 640px;
			height: 480px;
		}
	</style>
</head>
<body>
	<video id="video" autoplay></video>
	<script>
		var mimeCodec = 'video/mp4; codecs="avc1.42c015, mp4a.40.2"';

		var client = new WebSocket('ws://localhost:10086/')
		var video = document.getElementById('video')
		var mediaSource = new MediaSource()

		console.log(`mediaSource.readyState: ${mediaSource.readyState}`)
		console.log(`MediaSource.isTypeSupported(mimeCodec): ${MediaSource.isTypeSupported(mimeCodec)}`)

		video.src = window.URL.createObjectURL(mediaSource)
		mediaSource.addEventListener('sourceopen', function() {
			console.log(`mediaSource.readyState: ${mediaSource.readyState}`);
  			var sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);

			// sourceBuffer.addEventListener('update', function () {
			// 	console.log(`mediaSource.readyState: ${mediaSource.readyState}`)
			// 	sourceBuffer.appendBuffer(messageData);
			// });

			client.onmessage = function (event) {
				console.log(event);
				sourceBuffer.appendBuffer(event.data);
			}

			video.play();
			console.log(`mediaSource.readyState: ${mediaSource.readyState}`)
		})
	</script>

    <!-- <canvas id="videoCanvas" width="640" height="480"></canvas>
	<script src="./lib/jsmpeg/jsmpg.js"></script>
	<script>
		var client = new WebSocket('ws://localhost:10086/');
		var canvas = document.getElementById('videoCanvas');
		var player = new jsmpeg(client, {canvas:canvas});
	</script> -->

    <!-- <script src="./lib/jsmpeg-master/jsmpeg.min.js"></script>
    <script type="text/javascript">
        var canvas = document.getElementById('videoCanvas');
		var player = new JSMpeg.Player('ws://localhost:10086/', {canvas: canvas});
    </script> -->
</body>
</html>